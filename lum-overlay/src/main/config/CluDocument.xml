<?xml version="1.0" encoding="UTF-8"?>
<data xmlns="ns:workflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="ns:workflow resource:WorkflowData">
	<documentTypes xmlns="ns:workflow/DocumentType"
		xsi:schemaLocation="ns:workflow/DocumentType resource:DocumentType">

		<documentType>
			<name>CluDocument</name>
			<description>Simple Course workflow document</description>
			<label>CluDocument</label>
			<postProcessorName>
				edu.umd.ks.poc.util.CluApprovalPostProcessor
			</postProcessorName>
			<docHandler>
				${application.url}/edu.umd.ks.poc.lum.web.entrypoints.kew.KEW/KEW.html
			</docHandler>
			<superUserWorkgroupName>
				WorkflowAdmin
			</superUserWorkgroupName>
			<blanketApproveWorkgroupName>
				WorkflowAdmin
			</blanketApproveWorkgroupName>
			<defaultExceptionWorkgroupName>
				WorkflowAdmin
			</defaultExceptionWorkgroupName>
			<routePaths>
				<routePath>
					<start name="Proposal" nextNode="DeptApproveRequest" />
					<requests name="DeptApproveRequest" nextNode="AdminApproveRequest" />
					<requests name="AdminApproveRequest"/>
				</routePath>
			</routePaths>
			<routeNodes>
				<start name="Proposal">
					<activationType>S</activationType>
				</start>
				<requests name="DeptApproveRequest">
					<activationType>S</activationType>
					<ruleTemplate>DeptApproveTemplate</ruleTemplate>
				</requests>
				<requests name="AdminApproveRequest">
					<activationType>S</activationType>
					<ruleTemplate>AdminTemplate</ruleTemplate>
				</requests>
			</routeNodes>

            <attributes>
                <attribute>
                    <name>DeptCodeSearchAttribute</name>
                </attribute>
            </attributes>

		</documentType>

	</documentTypes>

	<ruleTemplates xmlns="ns:workflow/RuleTemplate"
		xsi:schemaLocation="ns:workflow/RuleTemplate resource:RuleTemplate">
		<ruleTemplate allowOverwrite="true">
			<name>DeptApproveTemplate</name>
			<description>
				Template for departmental approval routing
			</description>
			<attributes>
				<attribute>
					<name>DeptCode</name>
					<required>true</required>
				</attribute>
			</attributes>
		</ruleTemplate>
		<ruleTemplate allowOverwrite="true">
			<name>AdminTemplate</name>
			<description>
				Template for the clu node rules
			</description>
		</ruleTemplate>
	</ruleTemplates>

	<rules xmlns="ns:workflow/Rule"
	xsi:schemaLocation="ns:workflow/Rule resource:Rule">

	<!--  Named Rules (Templateless)
	|	Doesn't use templates and cannot be edited in workflow portal.
	|	Why would one use this type of rule?
	-->

	<!-- 	<rule>
			<documentType>CluDocument</documentType>
			<ruleTemplate>AdminTemplate</ruleTemplate>
			<description>Rule for Clu Approver</description>
			<ignorePrevious>false</ignorePrevious>
			<responsibilities>
				<responsibility>
					<user>admin</user>
					<actionRequested>A</actionRequested>
					<priority>1</priority>
				</responsibility>
			</responsibilities>
		</rule>-->

	<!-- There are two more rules to allow English Admin and Math admin based on the DeptCode, but I couldn't get them exported -->
	</rules>

	<ruleAttributes xmlns="ns:workflow/RuleAttribute"
	xsi:schemaLocation="ns:workflow/RuleAttribute resource:RuleAttribute">


	<!-- RuleXMLAttribute (An xml based rule attribute)
	|
	-->
		<ruleAttribute>
			<name>DeptCode</name>
			<className>edu.umd.ks.poc.util.ScatServiceRuleAttributeImpl</className>
            <label>foo</label>
            <description>foo</description>
			<type>RuleXmlAttribute</type>
			<routingConfig>
				<fieldDef name="DeptCode" title="Department Code"
					workflowType="ALL">
					<display>
						<type>select</type>
						<values title="Select...">Select</values>
					</display>
					<validation required="false">
						<regex>^[A-Za-z0-9]+$</regex>
						<message>Please select a Department</message>
					</validation>
					<fieldEvaluation>
						<xpathexpression>
							//@DeptCode =
							wf:ruledata('DeptCode')
						</xpathexpression>
					</fieldEvaluation>
				</fieldDef>
			</routingConfig>
		</ruleAttribute>

        <ruleAttribute>
            <name>DeptCodeSearchAttribute</name>
            <className>edu.umd.ks.poc.util.ScatServiceSearchableAttributeImpl</className>
            <label>DepartmentSearchAttribute</label>
            <description>DepartmentSearchAttribute</description>
            <type>SearchableXmlAttribute</type>
            <searchingConfig>
                <fieldDef name="DeptCode" title="Department Code">
                    <display>
                        <type>select</type>
                        <values title="Select..."></values>
                    </display>
                    <fieldEvaluation>
                        <xpathexpression>//@DeptCode</xpathexpression>
                    </fieldEvaluation>
                </fieldDef>
            </searchingConfig>
        </ruleAttribute>

	</ruleAttributes>
</data>