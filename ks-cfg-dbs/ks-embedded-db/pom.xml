<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>org.kuali.student.dbs</groupId>
    <artifactId>ks-embedded-db</artifactId>
    <version>1.0.0-m4-SNAPSHOT</version>
    <packaging>jar</packaging>
    <name>KS Embedded Database</name>
    <description>Kuali Student Embedded Database</description>
    <properties>
     <!-- The sql-maven-plugin uses the jdbc url to look in settings.xml for server credentials.
          You will need to define a server with an id that is the same as jdbc url.  It contains
          the credentials for the Kuali Student application.  Also define a server with an id that
          is the same as the jdbc url with ".dba" appended to the end.  The credentials for this
          server must have dba privileges on the database instance. 
     <server>
       <id>jdbc:oracle:thin:@localhost:1521:XE</id>
       <username>kualiStudentUsername</username>
       <password>kualiStudentPassword</password>
     </server>
     <server>
       <id>jdbc:oracle:thin:@localhost:1521:XE.dba</id>
       <username>dbaUsername</username>  <-- usually this is "system"
       <password>dbaPassword</password>
     </server>
     -->    
     <oracle.ks.embedded.jdbc.url>jdbc:oracle:thin:@localhost:1521:XE</oracle.ks.embedded.jdbc.url>
    </properties>
    <build>
      <plugins>
        <plugin>
         <groupId>org.codehaus.mojo</groupId>
         <artifactId>sql-maven-plugin</artifactId>
         <!-- version 1.4 does not work with Kuali Impex -->
         <version>1.3</version>
         <dependencies>
           <dependency>
             <groupId>com.oracle</groupId>
             <artifactId>ojdbc14</artifactId>
             <version>10.2.0.3.0</version>
           </dependency>
         </dependencies>
         <configuration>
          <driver>oracle.jdbc.OracleDriver</driver>
          <url>${oracle.ks.embedded.jdbc.url}</url>
          <autocommit>false</autocommit>
          <delimiter>/</delimiter>
          <delimiterType>row</delimiterType>
          <onError>continue</onError>
         </configuration>
         <executions>
           <execution>
            <id>drop-recreate-db</id>
            <phase>process-sources</phase>
            <goals>
              <goal>execute</goal>
            </goals>
            <configuration>
              <settingsKey>${oracle.ks.embedded.jdbc.url}.dba</settingsKey>
              <sqlCommand>
                DROP USER kuali CASCADE
                /
                CREATE USER kuali IDENTIFIED BY kuali
                /
                GRANT DBA TO kuali
                /
              </sqlCommand>
            </configuration>
          </execution>
           <execution>
            <id>drop-recreate-tables</id>
            <phase>process-sources</phase>
            <goals>
              <goal>execute</goal>
            </goals>
            <configuration>
              <srcFiles>
                <srcFile>${project.basedir}/src/sql/schema.sql</srcFile>
              </srcFiles>
            </configuration>
          </execution>
          <execution>
            <id>insert-data</id>
            <phase>process-sources</phase>
            <goals>
              <goal>execute</goal>
            </goals>
            <configuration>
              <fileset>
                <basedir>${project.basedir}/src/datasql</basedir>
                <includes>
                 <include>**/*.sql</include>
                </includes>
              </fileset>
            </configuration>
          </execution>
          <execution>
            <id>add-constraints</id>
            <phase>process-sources</phase>
            <goals>
              <goal>execute</goal>
            </goals>
            <configuration>
              <srcFiles>
                <srcFile>${project.basedir}/src/sql/schema-constraints.sql</srcFile>
              </srcFiles>
            </configuration>
          </execution>
         </executions>
       </plugin>
      </plugins>
    </build>
</project>