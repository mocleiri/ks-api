<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.kuali.student.deployments</groupId>
        <artifactId>ks-deployments</artifactId>
        <version>2.0.0-SNAPSHOT</version>
    </parent>
    <groupId>org.kuali.student.db</groupId>
    <artifactId>ks-cfg-dbs</artifactId>
    <version>2.0.0-SNAPSHOT</version>
    <packaging>pom</packaging>
    <name>KS DB Config</name>
    <description>Kuali Student Impex</description>
    <modules>
        <module>ks-rice-db</module>
        <module>ks-bundled-db</module>
        <module>ks-app-db</module>
    </modules>
    <properties>
        <jdbc.master.username>KS_SPRING_DB</jdbc.master.username>

        <oracle.dba.username>SYS AS SYSDBA</oracle.dba.username>
        <oracle.dba.password.encrypted>change_on_install</oracle.dba.password.encrypted>
        <oracle.dba.url>jdbc:oracle:thin:@localhost:1521:XE</oracle.dba.url>
        <mysql.dba.username>root</mysql.dba.username>
        <mysql.dba.url>jdbc:mysql://localhost</mysql.dba.url>

        <!-- All impex configurations need to have Ant compatibility mode -->
        <impex.antCompatibilityMode>true</impex.antCompatibilityMode>
        <!-- Impex properties with the prefix 'impex.xml' are used in the xml generation step of impex -->
        <impex.xml.password>${jdbc.master.username}</impex.xml.password>
        <impex.xml.username>${jdbc.master.username}</impex.xml.username>
        <impex.xml.schema>${jdbc.master.username}</impex.xml.schema>
        <impex.xml.oracle.url>${oracle.dba.url}</impex.xml.oracle.url>
        <impex.xml.mysql.url>${mysql.dba.url}</impex.xml.mysql.url>
        <impex.xml.dateFormat>yyyyMMddHHmmss</impex.xml.dateFormat>
        <!-- 
        The sql generation step of impex requires the schema file generated by impex to be in this location
        and all the xml files are expected in src/main/resources, rather than the default of src/main/impex
        -->
        <impex.xml.schemaXMLFile>${project.basedir}/src/main/resources/schema.xml</impex.xml.schemaXMLFile>
        <impex.dataXMLDir>${project.basedir}/src/main/resources</impex.dataXMLDir>

        <!-- Begin Impex SQL Generation Properties -->
        <!-- Due to the way the impex sql generation properties have to be configured,
	       the names of these properties are fixed to what the plugin supports -->
        <impex.basedir>${project.basedir}</impex.basedir>
        <impex.schema.name>${project.artifactId}</impex.schema.name>
        <!-- This property holds the top of the output folder for the sql generation plugin -->
        <impex.mvn.sql>${project.basedir}/src/main/resources/impex/sql</impex.mvn.sql>
        <!-- End Impex SQL Generation Properties -->


        <!-- Override the paths for the meta-inf plugin to capture the generated sql locations -->
        <sql.meta.input.base>${project.basedir}/src/main/resources</sql.meta.input.base>

        <!-- Settings needed for separate executions of the meta-inf plugin -->
        <sql.schema.include.oracle>impex/sql/oracle/${project.artifactId}.sql</sql.schema.include.oracle>
        <sql.data.include.oracle>impex/sql/oracle/K*.sql</sql.data.include.oracle>
        <sql.constraints.include.oracle>impex/sql/oracle/${project.artifactId}-constraints.sql</sql.constraints.include.oracle>
        <sql.meta.output.base.oracle>${project.build.outputDirectory}/META-INF/sql/oracle/${project.artifactId}</sql.meta.output.base.oracle>

        <sql.schema.include.mysql>impex/sql/mysql/${project.artifactId}.sql</sql.schema.include.mysql>
        <sql.data.include.mysql>impex/sql/mysql/K*.sql</sql.data.include.mysql>
        <sql.constraints.include.mysql>impex/sql/mysql/${project.artifactId}-constraints.sql</sql.constraints.include.mysql>
        <sql.meta.output.base.mysql>${project.build.outputDirectory}/META-INF/sql/mysql/${project.artifactId}</sql.meta.output.base.mysql>
        <spring.context.location>classpath:org/kuali/common/deploy/spring/db-developer-context.xml</spring.context.location>
    </properties>
    <build>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>org.kuali.maven.plugins</groupId>
                    <artifactId>spring-maven-plugin</artifactId>
                    <executions>
                        <execution>
                            <id>load</id>
                            <phase>initialize</phase>
                            <goals>
                                <goal>load</goal>
                            </goals>
                            <configuration>
                                <location>${spring.context.location}</location>
                                <propertiesBeanName>deploy.mavenProperties</propertiesBeanName>
                            </configuration>
                        </execution>
                    </executions>
                    <dependencies>
                        <dependency>
                            <groupId>org.kuali.student.core</groupId>
                            <artifactId>ks-core-sql</artifactId>
                            <version>${ks.core.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.student.core</groupId>
                            <artifactId>ks-rice-sql</artifactId>
                            <version>${ks.core.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.student.lum</groupId>
                            <artifactId>ks-lum-sql</artifactId>
                            <version>${ks.lum.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.student.enroll</groupId>
                            <artifactId>ks-enroll-sql</artifactId>
                            <version>${ks.enroll.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.common</groupId>
                            <artifactId>kuali-deploy</artifactId>
                            <version>${kuali-deploy.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.common</groupId>
                            <artifactId>kuali-jdbc</artifactId>
                            <version>${kuali-jdbc.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.common</groupId>
                            <artifactId>kuali-util</artifactId>
                            <version>${kuali-util.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.rice</groupId>
                            <artifactId>rice-impex-server-bootstrap</artifactId>
                            <version>${kuali.rice.version}</version>
                            <classifier>sql</classifier>
                        </dependency>
                        <dependency>
                            <groupId>mysql</groupId>
                            <artifactId>mysql-connector-java</artifactId>
                            <version>${mysql.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>com.oracle</groupId>
                            <artifactId>${oracle.artifactId}</artifactId>
                            <version>${oracle.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.student.deployments</groupId>
                            <artifactId>ks-deployment-resources</artifactId>
                            <version>${project.parent.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.student.db</groupId>
                            <artifactId>ks-bundled-db</artifactId>
                            <version>${project.parent.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.student.db</groupId>
                            <artifactId>ks-app-db</artifactId>
                            <version>${project.parent.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>org.kuali.student.db</groupId>
                            <artifactId>ks-rice-db</artifactId>
                            <version>${project.parent.version}</version>
                        </dependency>
                    </dependencies>
                </plugin>
                <plugin>
                    <groupId>org.kuali.maven.plugins</groupId>
                    <artifactId>maven-impex-plugin</artifactId>
                    <version>${plugin.impex.version}</version>
                    <dependencies>
                        <dependency>
                            <groupId>mysql</groupId>
                            <artifactId>mysql-connector-java</artifactId>
                            <version>${mysql.version}</version>
                        </dependency>
                        <dependency>
                            <groupId>com.oracle</groupId>
                            <artifactId>${oracle.artifactId}</artifactId>
                            <version>${oracle.version}</version>
                        </dependency>
                    </dependencies>
                    <configuration>
                        <username>${impex.xml.username}</username>
                        <password>${impex.xml.password}</password>
                        <url>${impex.xml.url}</url>
                        <schema>${impex.xml.schema}</schema>
                        <schemaXMLFile>${impex.xml.schemaXMLFile}</schemaXMLFile>
                        <dataXMLDir>${impex.dataXMLDir}</dataXMLDir>
                        <outputDir>${project.build.directory}/impex/</outputDir>
                        <antCompatibilityMode>${impex.antCompatibilityMode}</antCompatibilityMode>
                        <includes>${impex.xml.includedTables}</includes>
                        <excludes>${impex.xml.excludedTables}</excludes>
                        <dateFormat>${impex.xml.dateFormat}</dateFormat>
                    </configuration>
                    <executions>
                        <execution>
                            <id>exportXML</id>
                            <goals>
                                <goal>exportschema</goal>
                                <goal>exportdata</goal>
                                <goal>datadtd</goal>
                            </goals>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.kuali.maven.plugins</groupId>
                    <artifactId>mvn-maven-plugin</artifactId>
                    <version>${plugin.mvn.version}</version>
                    <executions>
                        <execution>
                            <id>sql</id>
                            <phase>process-resources</phase>
                            <goals>
                                <goal>mvn</goal>
                            </goals>
                            <configuration>
                                <args>
                                    <arg>process-resources</arg>
                                    <arg>-e</arg>
                                    <arg>-DantCompatibilityMode=${impex.antCompatibilityMode}</arg>
                                </args>
                                <poms>
                                    <param>classpath:org/kuali/common/deploy/mvn/impex-with-sql.xml</param>
                                </poms>
                                <properties>
                                    <property>impex.basedir</property>
                                    <property>impex.schema.name</property>
                                    <property>plugin.impex.version</property>
                                    <property>impex.mvn.sql</property>
                                </properties>
                            </configuration>
                        </execution>
                    </executions>
                    <dependencies>
                        <dependency>
                            <groupId>org.kuali.common</groupId>
                            <artifactId>kuali-deploy</artifactId>
                            <version>${kuali-deploy.version}</version>
                        </dependency>
                    </dependencies>
                </plugin>
                <plugin>
                    <groupId>org.kuali.maven.plugins</groupId>
                    <artifactId>metainf-maven-plugin</artifactId>
                    <executions>
                        <execution>
                            <id>oracle-schema</id>
                            <goals>
                                <goal>metainf</goal>
                            </goals>
                            <configuration>
                                <include>${sql.schema.include.oracle}</include>
                                <outputFile>${sql.meta.output.base.oracle}-schema.resources</outputFile>
                            </configuration>
                        </execution>
                        <execution>
                            <id>oracle-data</id>
                            <goals>
                                <goal>metainf</goal>
                            </goals>
                            <configuration>
                                <include>${sql.data.include.oracle}</include>
                                <outputFile>${sql.meta.output.base.oracle}-data.resources</outputFile>
                            </configuration>
                        </execution>
                        <execution>
                            <id>oracle-constraints</id>
                            <goals>
                                <goal>metainf</goal>
                            </goals>
                            <configuration>
                                <include>${sql.constraints.include.oracle}</include>
                                <outputFile>${sql.meta.output.base.oracle}-constraints.resources</outputFile>
                            </configuration>
                        </execution>

                        <execution>
                            <id>mysql-schema</id>
                            <goals>
                                <goal>metainf</goal>
                            </goals>
                            <configuration>
                                <include>${sql.schema.include.mysql}</include>
                                <outputFile>${sql.meta.output.base.mysql}-schema.resources</outputFile>
                            </configuration>
                        </execution>
                        <execution>
                            <id>mysql-data</id>
                            <goals>
                                <goal>metainf</goal>
                            </goals>
                            <configuration>
                                <include>${sql.data.include.mysql}</include>
                                <outputFile>${sql.meta.output.base.mysql}-data.resources</outputFile>
                            </configuration>
                        </execution>
                        <execution>
                            <id>mysql-constraints</id>
                            <goals>
                                <goal>metainf</goal>
                            </goals>
                            <configuration>
                                <include>${sql.constraints.include.mysql}</include>
                                <outputFile>${sql.meta.output.base.mysql}-constraints.resources</outputFile>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
            </plugins>
        </pluginManagement>
    </build>
    <profiles>
        <profile>
            <id>master-db</id>
            <properties>
                <db.vendor>oracle</db.vendor>
                <jdbc.master.username>KS_SPRING_DB</jdbc.master.username>
                <oracle.master.dba.url>jdbc:oracle:thin:@oracle.ks.kuali.org:1521:ORACLE</oracle.master.dba.url>

                <oracle.dba.username>master</oracle.dba.username>
                <oracle.dba.password.encrypted>eEFVZmL4+y/5KlzDMCt6dGlBKQzXevFp</oracle.dba.password.encrypted>
                <oracle.dba.url>${oracle.master.dba.url}</oracle.dba.url>
                <jdbc.username>${jdbc.master.username}</jdbc.username>

                <!-- Schemas -->
                <db.rice.baseline.schema>rice-impex-server-bootstrap</db.rice.baseline.schema>
                <db.ks.core.schema>ks-core-sql</db.ks.core.schema>
                <db.ks.lum.schema>ks-lum-sql</db.ks.lum.schema>
                <db.ks.enroll.schema>ks-enroll-sql</db.ks.enroll.schema>
                <db.ks.rice.schema>ks-rice-sql</db.ks.rice.schema>

                <!-- SQL resources -->
                <sql.meta.base>classpath:META-INF/sql/oracle</sql.meta.base>

                <sql.schema.1>classpath:sql/oracle/${db.rice.baseline.schema}.sql</sql.schema.1>
                <sql.schema.2.list>${sql.meta.base}/${db.ks.core.schema}-schema.resources</sql.schema.2.list>
                <sql.schema.3.list>${sql.meta.base}/${db.ks.lum.schema}-schema.resources</sql.schema.3.list>
                <sql.schema.4.list>${sql.meta.base}/${db.ks.enroll.schema}-schema.resources</sql.schema.4.list>
                <sql.schema.5.list>${sql.meta.base}/${db.ks.rice.schema}-schema.resources</sql.schema.5.list>

                <sql.data.1.list>${db.rice.baseline.schema}-data.resources</sql.data.1.list>
                <sql.data.2.list>${sql.meta.base}/${db.ks.core.schema}-data.resources</sql.data.2.list>
                <sql.data.3.list>${sql.meta.base}/${db.ks.lum.schema}-data.resources</sql.data.3.list>
                <sql.data.4.list>${sql.meta.base}/${db.ks.enroll.schema}-data.resources</sql.data.4.list>
                <sql.data.5.list>${sql.meta.base}/${db.ks.rice.schema}-data.resources</sql.data.5.list>

                <sql.constraints.1>classpath:sql/oracle/${db.rice.baseline.schema}-constraints.sql</sql.constraints.1>
                <sql.constraints.2.list>${sql.meta.base}/${db.ks.core.schema}-constraints.resources</sql.constraints.2.list>
                <sql.constraints.3.list>${sql.meta.base}/${db.ks.lum.schema}-constraints.resources</sql.constraints.3.list>
                <sql.constraints.4.list>${sql.meta.base}/${db.ks.enroll.schema}-constraints.resources</sql.constraints.4.list>
                <sql.constraints.5.list>${sql.meta.base}/${db.ks.rice.schema}-constraints.resources</sql.constraints.5.list>

                <!-- Run upgrade scripts in the constraints list, after all baseline scripts have been applied -->
                <sql.constraints.6.list>${sql.meta.base}/${db.ks.core.schema}-upgrades.resources</sql.constraints.6.list>
                <sql.constraints.7.list>${sql.meta.base}/${db.ks.rice.schema}-upgrades.resources</sql.constraints.7.list>
                <sql.constraints.8.list>${sql.meta.base}/${db.ks.lum.schema}-upgrades.resources</sql.constraints.8.list>
                <sql.constraints.9.list>${sql.meta.base}/${db.ks.enroll.schema}-upgrades.resources</sql.constraints.9.list>

                <!-- Controller properties -->
                <sql.schema.concurrent>sql.schema.1,sql.schema.2.list,sql.schema.3.list,sql.schema.4.list,sql.schema.5.list</sql.schema.concurrent>
                <sql.data.concurrent>sql.data.2.list,sql.data.3.list,sql.data.4.list</sql.data.concurrent>
                <sql.data.sequential>sql.data.1.list,sql.data.5.list</sql.data.sequential>
                <sql.constraints.order>concurrent,sequential</sql.constraints.order>
                <sql.constraints.concurrent>sql.constraints.2.list,sql.constraints.3.list,sql.constraints.4.list</sql.constraints.concurrent>
                <sql.constraints.sequential>sql.constraints.1,sql.constraints.5.list,sql.constraints.6.list,sql.constraints.7.list,sql.constraints.8.list,sql.constraints.9.list</sql.constraints.sequential>
            </properties>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.kuali.maven.plugins</groupId>
                        <artifactId>spring-maven-plugin</artifactId>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>oracle</id>
            <properties>
                <db.vendor>oracle</db.vendor>
                <impex.xml.url>${impex.xml.oracle.url}</impex.xml.url>
            </properties>
        </profile>
        <profile>
            <id>mysql</id>
            <properties>
                <db.vendor>mysql</db.vendor>
                <impex.xml.url>${impex.xml.mysql.url}</impex.xml.url>
            </properties>
        </profile>
    </profiles>
</project>
