<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:search="http://student.kuali.org/xsd/search-extension"
	xmlns:dict="http://student.kuali.org/xsd/dictionary-extension"
	xsi:schemaLocation="
	http://student.kuali.org/xsd/search-extension http://student.kuali.org/xsd/search-extension/search-extension.xsd
	http://student.kuali.org/xsd/dictionary-extension http://student.kuali.org/xsd/dictionary-extension/dictionary-extension.xsd
	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
	 ">
	 
	<import resource="lo-dictionary-config.xml" />
	
    <search:searchType id="lo.search.loByName">
        <search:name>LoSearchByName</search:name>
        <search:desc>Retrieve LO by name</search:desc>
        <search:searchResultTypeInfo>
            <ref bean="lo.result.los" />
        </search:searchResultTypeInfo>
		<search:searchCriteriaTypeInfo>
			<ref bean="lo.criteria.loName" />
		</search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="lo.search.los">
        <search:name>LO Search for all LOs</search:name>
        <search:desc>Returns all available LOs</search:desc>
        <search:searchResultTypeInfo>
            <ref bean="lo.result.los" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
           <ref bean="lo.criteria.all"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>
    
    <search:searchType id="lo.search.loByDesc">
        <search:name>LO Search for all LOs matching supplied word</search:name>
        <search:desc>Returns all matching LOs</search:desc>
        <search:searchResultTypeInfo>
            <ref bean="lo.result.loDesc" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
           <ref bean="lo.criteria.loByDesc"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="lo.search.loCluByDesc">
        <search:name>LO Search for all LOs and related Clus matching supplied word</search:name>
        <search:desc>Returns all matching LOs ids and related Clu ids and codes</search:desc>
        <search:searchResultTypeInfo>
        	<ref bean="lo.result.loClu" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
        	<ref bean="lo.criteria.loByDesc"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="lo.search.loByCategory">
        <search:name>LO Search for all LOs by matching category</search:name>
        <search:desc>Returns all matching LOs ids </search:desc>
        <search:searchResultTypeInfo>
        	<ref bean="lo.result.loClu" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
        	<ref bean="lo.criteria.byCategoryName"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>
    
    <search:searchType id="lo.search.categories">
        <search:name>LO Search for all categories</search:name>
        <search:desc>Returns all matching category names </search:desc>
        <search:searchResultTypeInfo>
        	<ref bean="lo.result.categoryName" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
        	<ref bean="lo.criteria.byCategoryName"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>
    
    <search:searchCriteriaTypeInfo id="lo.criteria.all">
        <search:name>LoLo</search:name>
        <search:desc>Placeholder Criteria</search:desc>
    </search:searchCriteriaTypeInfo>
	
	<search:searchCriteriaTypeInfo id="lo.criteria.loName">
		<search:name>LoSearchByNameCriteria</search:name>
		<search:desc>Search criteria for searching for learning objectives by name</search:desc>
        <search:queryParams>
            <ref bean="lo.queryParam.loName" />
        </search:queryParams>
	</search:searchCriteriaTypeInfo>
	
	<search:searchCriteriaTypeInfo id="lo.criteria.loByDesc">
		<search:name>LoByWordMatchCriteria</search:name>
		<search:queryParams>
			<ref bean="lo.queryParam.loDescPlain" />
		</search:queryParams>
	</search:searchCriteriaTypeInfo>
	
	<search:searchCriteriaTypeInfo id="lo.criteria.byCategoryName">
		<search:name>LoByCategoryCriteria</search:name>
		<search:queryParams>
			<ref bean="lo.queryParam.loCategoryName" />
		</search:queryParams>
	</search:searchCriteriaTypeInfo>
		
    <search:queryParam id="lo.queryParam.loName">
        <dict:fieldDescriptor>
            <dict:name>Learning Objective Name</dict:name>
	        <dict:desc>Human-readable name for learning objective</dict:desc>
	        <dict:dataType>string</dict:dataType>
	        <dict:readOnly>true</dict:readOnly>
        </dict:fieldDescriptor>
    </search:queryParam>
    
	<search:queryParam id="lo.queryParam.loDescPlain">
        <dict:fieldDescriptor parent="parentFieldDescriptor">
            <dict:name>Description</dict:name>
        </dict:fieldDescriptor>
    </search:queryParam>
       
	<search:queryParam id="lo.queryParam.loCategoryName">
        <dict:fieldDescriptor parent="parentFieldDescriptor">
            <dict:name>Category</dict:name>
        </dict:fieldDescriptor>
    </search:queryParam>
    
    <search:queryParam id="lo.queryParam.loCategoryId">
		<dict:fieldDescriptor parent="parentFieldDescriptor">
			<dict:name>LO category Id</dict:name>
		</dict:fieldDescriptor>
	</search:queryParam>
	
    <search:searchResultTypeInfo id="lo.result.los">
        <search:name>Los</search:name>
        <search:desc>List Los</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.loId" />
            <ref bean="lo.resultColumn.loName" />
        </search:resultColumns>
    </search:searchResultTypeInfo>

    <search:searchResultTypeInfo id="lo.result.loDesc">
        <search:name>Los</search:name>
        <search:desc>Lo descs</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.loDescId" />
            <ref bean="lo.resultColumn.loDescPlain" />
        </search:resultColumns>
    </search:searchResultTypeInfo>
    
    <search:searchResultTypeInfo id="lo.result.loClu">
        <search:name>Los and Related Clus</search:name>
        <search:desc>Lo descs ids and Clu ids and Codes</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.loId" />
            <ref bean="lo.resultColumn.loCluId" />
            <ref bean="lo.resultColumn.loCluCode" />
        	<ref bean="lo.resultColumn.loDescPlain" />
        </search:resultColumns>
    </search:searchResultTypeInfo>
    
    <search:searchResultTypeInfo id="lo.result.categoryName">
        <search:name>Los and Related Clus</search:name>
        <search:desc>Lo descs ids and Clu ids and Codes</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.categoryId" />
            <ref bean="lo.resultColumn.categoryName" />
        </search:resultColumns>
    </search:searchResultTypeInfo>
    
    <search:resultColumn id="lo.resultColumn.loId">
        <search:name>Lo Identifier</search:name>
        <search:desc>Identifier of an Lo</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
	
	<search:resultColumn id="lo.resultColumn.loCluId">
        <search:name>Clu Identifier</search:name>
        <search:desc>Identifier of a Clu</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
    
    <search:resultColumn id="lo.resultColumn.loCluCode">
        <search:name>Clu Code</search:name>
        <search:desc>Clu Code</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>

    <search:resultColumn id="lo.resultColumn.loName">
        <search:name>Lo Name</search:name>
        <search:desc>Official name of an Lo</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
    
    <search:resultColumn id="lo.resultColumn.loDescId">
        <search:name>Desc Identifier</search:name>
        <search:desc>Identifier of an LO desc </search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>

    <search:resultColumn id="lo.resultColumn.loDescPlain">
        <search:name>Lo Desc</search:name>
        <search:desc>Desc of an Lo</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>

    <search:resultColumn id="lo.resultColumn.categoryName">
        <search:name>Category</search:name>
        <search:desc>Category to be used for an LO</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
        
    <search:resultColumn id="lo.resultColumn.categoryId">
        <search:name>Category ID</search:name>
        <search:desc>Category to be used for an LO</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
    
    <dict:fieldDescriptor id="parentFieldDescriptor">
        <dict:name>Comment Identifier</dict:name>
        <dict:desc>Unique identifier for a desc.</dict:desc>
        <dict:dataType>string</dict:dataType>
        <dict:readOnly>true</dict:readOnly>
    </dict:fieldDescriptor>
    
	<bean id="queryMap" class="org.springframework.beans.factory.config.MapFactoryBean">
		<property name="sourceMap">
			<map>
				<entry key="lo.search.los">
					<value>SELECT lo.id, lo.name FROM Lo lo </value>
				</entry>
				<entry key="lo.search.loByDesc">
                    <value>SELECT lo.id, loDesc.plain FROM Lo lo JOIN lo.desc loDesc WHERE lower(loDesc.plain) like :lo_queryParam_loDescPlain</value>
				</entry>			
				<entry key="lo.search.loByName">
					<value>SELECT lo.id, lo.name FROM Lo lo WHERE lo.name = :lo_queryParam_loName</value>
				</entry>
				<entry key="lo.search.categories">
                    <value>SELECT cat.id, cat.name FROM LoCategory cat WHERE cat.name like :lo_queryParam_loCategoryName or cat.id = :lo_queryParam_loCategoryId</value>
				</entry>
				<!--  These native searches are temporary solutions to allow cross service searches in advance of the KS permanent 
				      cross service search implementation  -->
				<entry key="lo.search.loCluByDesc">
					<value>NATIVE:SELECT 
    lo.id lo_id, 
    clu.id clu_id, 
    officialIdentifier.cd code, 
    lodesc.plain plain 
FROM 
    KSLU_CLU clu 
JOIN 
    KSLU_LO_JN_CLU jn 
    ON 
    jn.CLU_ID = clu.ID 
JOIN 
    KSLU_LO lo 
    ON 
    jn.LO_ID = lo.ID 
JOIN 
    KSLU_CLU_IDENT officialIdentifier 
    ON 
    clu.OFFIC_CLU_ID = officialIdentifier.ID 
JOIN 
    KS_LO_RICH_TEXT_T lodesc 
    ON 
    lodesc.ID = lo.RT_DESCR_ID 
WHERE 
    lower(lodesc.PLAIN) like :lo_queryParam_loDescPlain
					</value>
    			</entry>
    			<entry key="lo.search.loByCategory">				
					<value>NATIVE:SELECT 
    lo.id lo_id, 
    clu.id clu_id, 
    officialIdentifier.cd code, 
    lodesc.plain plain 
FROM 
    KSLU_CLU clu 
JOIN 
    KSLU_LO_JN_CLU jn 
    ON 
    jn.CLU_ID = clu.ID 
JOIN 
    KSLU_LO lo 
    ON 
    jn.LO_ID = lo.ID 
JOIN 
    KSLU_CLU_IDENT officialIdentifier 
    ON 
    clu.OFFIC_CLU_ID = officialIdentifier.ID 
JOIN 
    KS_LO_RICH_TEXT_T lodesc 
    ON 
    lodesc.ID = lo.RT_DESCR_ID 
JOIN 
    KSLU_LO_JN_LOCATEGORY jncat
    ON
    lo.id = jncat.lo_id
JOIN
    KSLU_LO_CATEGORY cat
    ON
    cat.id = jncat.locategory_id

WHERE 
    lower(cat.name) like :lo_queryParam_loCategoryName
					</value>
				</entry>
            </map>
		</property>
	</bean>

</beans>
