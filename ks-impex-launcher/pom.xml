<project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

    <modelVersion>4.0.0</modelVersion>

    <groupId>org.kuali.student.dev</groupId>
    <artifactId>ks-impex-launcher</artifactId>
    <version>1.0.0</version>
    <packaging>pom</packaging>

    <parent>
        <artifactId>ks-launcher</artifactId>
        <groupId>org.kuali.student.dev</groupId>
        <version>1.0.0</version>
    </parent>

    <properties>
        <import.admin.password>kuali</import.admin.password>
        <oracle.version>10.2.0.3.0</oracle.version>
    </properties>
    
    <build>
        <plugins>
        
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-scm-plugin</artifactId>
                <version>1.2</version>

                <configuration>
                    <providerImplementations>
                        <svn>javasvn</svn>
                    </providerImplementations>
                </configuration>
                
                <dependencies>
                    <dependency>
                        <groupId>com.google.scm.svnjava</groupId>
                        <artifactId>maven-scm-provider-svnjava</artifactId>
                        <version>1.2.1</version>
                    </dependency>
                </dependencies>
                
                <executions>
                    <execution>
                        <id>impex-checkout</id>
                        <phase>verify</phase>
                        <goals>
                            <goal>checkout</goal>
                        </goals>
                        <inherited>false</inherited>
                        <configuration>
                            <basedir>target</basedir>
                            <checkoutDirectory>${project.build.directory}/impex-checkout</checkoutDirectory>
                            <connectionUrl>scm:javasvn:https://test.kuali.org/svn/kul-cfg-dbs/trunk</connectionUrl>
                            <skipCheckoutIfExists>true</skipCheckoutIfExists>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

        </plugins>
        
    </build>

    <profiles>

        <profile>
            <id>ks.run.impex</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
    
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <version>1.1</version>
    
                        <executions>
                            <execution>
                                <id>run-impex</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
    
                                <configuration>
                                    <sourceRoot>target/impex-checkout/impex</sourceRoot>
                                    <tasks>
                                        <property name="build.compiler" value="extJavac" />
                                        
                                        <property file="${basedir}/src/main/resources/ks.custom.properties" />
                                        <property file="${basedir}/src/main/resources/ks.impex.properties" />
                                        
                                        <property name="plugin_classpath" refid="maven.plugin.classpath" />
                                        <echo message="plugin classpath: ${plugin_classpath}" />
                                        <echo message="maven.plugin.classpath=__DELETE__${plugin_classpath}"
                                            file="${project.build.directory}/impex-checkout/impex/replace.properties" />
                                        <replace
                                            file="${project.build.directory}/impex-checkout/impex/replace.properties"
                                            token="\" value="/" />
                                        <replace
                                            file="${project.build.directory}/impex-checkout/impex/build.xml"
                                            propertyFile="${project.build.directory}/impex-checkout/impex/replace.properties">
                                            <replacefilter token="{java.class.path}"
                                                property="maven.plugin.classpath" />
                                        </replace>
                                        <replace
                                            file="${project.build.directory}/impex-checkout/impex/build.xml"
                                            token="$__DELETE__" value="" />
                                        <copy
                                            file="${project.build.directory}/impex-checkout/impex/database.dtd"
                                            todir="." />
                                        <ant antfile="build.xml"
                                            dir="${project.build.directory}/impex-checkout/impex">
                                            <target name="create-schema" />
                                            <target name="satellite-update" />
                                        </ant>
                                        <delete file="database.dtd" />
                                    </tasks>
                                </configuration>
                            </execution>
                        </executions>
                    
                        <dependencies>                    
                            <dependency>
                                <groupId>com.oracle</groupId>
                                <artifactId>ojdbc14</artifactId>
                                <version>${oracle.version}</version>
                            </dependency>
                            
                            <!-- use jars from the impex checkout as some can't be downloaded -->  
                            <dependency>
                                <groupId>ant</groupId>
                                <artifactId>ant</artifactId>
                                <version>1.6.5</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/ant-1.6.5.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>ant-contrib</groupId>
                                <artifactId>ant-contrib</artifactId>
                                <version>1.0b3</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/ant-contrib-1.0b3.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>antlr</groupId>
                                <artifactId>antlr</artifactId>
                                <version>2.7.5</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/antlr-2.7.5.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>avalon-logkit</groupId>
                                <artifactId>avalon-logkit</artifactId>
                                <version>2.1</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/avalon-logkit-2.1.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>commons-collections</groupId>
                                <artifactId>commons-collections</artifactId>
                                <version>3.1</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/commons-collections-3.1.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>commons-lang</groupId>
                                <artifactId>commons-lang</artifactId>
                                <version>2.1</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/commons-lang-2.1.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>commons-logging</groupId>
                                <artifactId>commons-logging</artifactId>
                                <version>1.0.4</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/commons-logging-1.0.4.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>log4j</groupId>
                                <artifactId>log4j</artifactId>
                                <version>1.2.14</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/log4j-1.2.14.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>velocity</groupId>
                                <artifactId>texen</artifactId>
                                <version>1.0</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/texen-1.0.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>velocity</groupId>
                                <artifactId>velocity</artifactId>
                                <version>1.5</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/velocity-1.5.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>village</groupId>
                                <artifactId>village</artifactId>
                                <version>2.0</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/village-2.0.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>werken-xpath</groupId>
                                <artifactId>werken-xpath</artifactId>
                                <version>0.9.4</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/werken-xpath-0.9.4.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>xerces</groupId>
                                <artifactId>xercesImpl</artifactId>
                                <version>2.6.2</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/xercesImpl-2.6.2.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>xml-apis</groupId>
                                <artifactId>xml-apis</artifactId>
                                <version>2.0.2</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/xml-apis-2.0.2.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>ganymed</groupId>
                                <artifactId>ganymed</artifactId>
                                <version>1.0</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/ganymed.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>svnant</groupId>
                                <artifactId>svnant</artifactId>
                                <version>1.0</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/svnant.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>svnkit</groupId>
                                <artifactId>svnkit</artifactId>
                                <version>1.0</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/svnkit.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>svnClientAdapter</groupId>
                                <artifactId>svnClientAdapter</artifactId>
                                <version>1.0</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/svnClientAdapter.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>svnjavahl</groupId>
                                <artifactId>svnjavahl</artifactId>
                                <version>1.0</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/lib/svnjavahl.jar</systemPath>
                            </dependency>
                            <dependency>
                                <groupId>kuali-impextasks</groupId>
                                <artifactId>kuali-impextasks</artifactId>
                                <version>1.0</version>
                                <scope>system</scope>
                                <systemPath>${project.build.directory}/impex-checkout/impex/kuali-impextasks.jar</systemPath>
                            </dependency>
                        </dependencies>
                    </plugin>
                </plugins>
            </build>
            
        </profile>
    
        <profile>
            <id>ks.setup.oracle</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>sql-maven-plugin</artifactId>
                        <version>1.1</version>

                        <configuration>
                            <driver>oracle.jdbc.driver.OracleDriver</driver>
                            <url>jdbc:oracle:thin:@localhost:1521:XE</url>
                            <username>SYS as SYSDBA</username>
                            <password>${import.admin.password}</password>
                            <delimiter>/</delimiter>
                            <onError>continue</onError>
                        </configuration>
                        
                        <executions>
                            <execution>
                                <id>SYS-SQL-Scripts</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>execute</goal>
                                </goals>
                                <configuration>
                                    <sqlCommand>
                                        alter system set processes=150 scope=spfile/
                                        alter system set sessions=150 scope=spfile/
                                    </sqlCommand>
                                    <srcFiles>
                                        <srcFile>${project.build.directory}/impex-checkout/impex/create_kul_developer.sql</srcFile>
                                        <srcFile>${project.build.directory}/impex-checkout/impex/system_grants.sql</srcFile>
                                    </srcFiles>
                                </configuration>
                            </execution>
                            <execution>
                                <id>KULUSERMAINT-SQL-Scripts</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>execute</goal>
                                </goals>
                                <configuration>
                                    <username>KULUSERMAINT</username>
                                    <password>KULUSERMAINT</password>
                                    <srcFiles>
                                        <srcFile>${project.build.directory}/impex-checkout/impex/create_admin_user.sql</srcFile>
                                        <srcFile>${project.build.directory}/impex-checkout/impex/kuluser_maint_pk.sql</srcFile>
                                    </srcFiles>
                                </configuration>
                            </execution>
                        </executions>

                        <dependencies>
                            <dependency>
                                <groupId>com.oracle</groupId>
                                <artifactId>ojdbc14</artifactId>
                                <version>${oracle.version}</version>
                            </dependency>
                        </dependencies>
                    </plugin>
                    
                </plugins>
            </build>
        </profile>
    </profiles>
    
</project>