<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:search="http://student.kuali.org/xsd/search-extension"
	xmlns:dict="http://student.kuali.org/xsd/dictionary-extension"
	xsi:schemaLocation="
	http://student.kuali.org/xsd/search-extension http://student.kuali.org/xsd/search-extension/search-extension.xsd
	http://student.kuali.org/xsd/dictionary-extension http://student.kuali.org/xsd/dictionary-extension/dictionary-extension.xsd
	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
	 ">
	 
	<import resource="lo-dictionary-config.xml" />
	
	<search:crossSearchType id="lo.search.loByDescCrossSearch">
        <search:name>LO Search for all LOs and related Clus matching supplied word</search:name>
        <search:desc>Returns all matching LOs ids and related Clu ids and codes</search:desc>
        <search:searchResultTypeInfo>
        	<ref bean="lo.result.loCluByDesc" />  <!-- need to add one column below for categoryName -->
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
        	<ref bean="lo.criteria.loByDesc"/>
        </search:searchCriteriaTypeInfo>
        <search:subSearch searchkey="lo.search.loByDesc" key="lo">
	        <search:subSearchParamMappings crossSearchParam="lo.queryParam.loDescPlain" subSearchParam="lo.queryParam.loDescPlain"/>
        </search:subSearch>
        <search:subSearch searchkey="lu.search.allLoQuickView" key="clu"/>
		<search:joinCriteria type="AND">
			<search:comparison type="EQUALS">
				<search:leftHandSide subSearchKey="lo" param="lo.resultColumn.loDescId"/>
				<search:rightHandSide subSearchKey="clu" param="lu.resultColumn.loId"/>
			</search:comparison>
		</search:joinCriteria>
		<search:joinResultMapping subSearchResultParam="lo.resultColumn.loDescId" subSearchKey="lo" resultParam="lo.resultColumn.loId"/>
		<search:joinResultMapping subSearchResultParam="lu.resultColumn.cluId" subSearchKey="clu" resultParam="lo.resultColumn.loCluId"/>
		<search:joinResultMapping subSearchResultParam="lu.resultColumn.cluOfficialIdentifier.cluCode" subSearchKey="clu" resultParam="lo.resultColumn.loCluCode"/>
		<search:joinResultMapping subSearchResultParam="lo.resultColumn.loDescPlain" subSearchKey="lo" resultParam="lo.resultColumn.loDescPlain"/>
	</search:crossSearchType>
	
    <search:searchType id="lo.search.loByName">
        <search:name>LoSearchByName</search:name>
        <search:desc>Retrieve LO by name</search:desc>
        <search:searchResultTypeInfo>
            <ref bean="lo.result.los" />
        </search:searchResultTypeInfo>
		<search:searchCriteriaTypeInfo>
			<ref bean="lo.criteria.loName" />
		</search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="lo.search.los">
        <search:name>LO Search for all LOs</search:name>
        <search:desc>Returns all available LOs</search:desc>
        <search:searchResultTypeInfo>
            <ref bean="lo.result.los" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
           <ref bean="lo.criteria.all"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>
    
    <search:searchType id="lo.search.loByDesc">
        <search:name>LO Search for all LOs matching supplied word</search:name>
        <search:desc>Returns all matching LOs</search:desc>
        <search:searchResultTypeInfo>
            <ref bean="lo.result.loDesc" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
           <ref bean="lo.criteria.loByDesc"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="lo.search.loCluByDesc">
        <search:name>LO Search for all LOs and related Clus matching supplied word</search:name>
        <search:desc>Returns all matching LOs ids and related Clu ids and codes</search:desc>
        <search:searchResultTypeInfo>
        	<ref bean="lo.result.loCluByDesc" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
        	<ref bean="lo.criteria.loByDesc"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="lo.search.loByCategory">
        <search:name>LO Search for all LOs by matching category</search:name>
        <search:desc>Returns all matching LOs ids </search:desc>
        <search:searchResultTypeInfo>
        	<ref bean="lo.result.loClu" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
        	<ref bean="lo.criteria.byOptionalCategoryName"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>
    
    <search:searchType id="lo.search.loByCluCode">
        <search:name>LO Search for all LOs by Clu Code</search:name>
        <search:desc>Returns all matching LOs ids </search:desc>
        <search:searchResultTypeInfo>
        	<ref bean="lo.result.loClu" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
        	<ref bean="lo.criteria.byCludCode"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>    
    
    <search:searchType id="lo.search.loCategories">
        <search:name>LO Search for all categories</search:name>
        <search:desc>Returns all matching category names </search:desc>
        <search:searchResultTypeInfo>
        	<ref bean="lo.result.categoryName" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
        	<ref bean="lo.criteria.byCategoryName"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>
    
    <search:searchType id="lo.search.loCategoriesByNameRepoTypeState">
        <search:name>LO Search for all categories based on name, type and state</search:name>
        <search:desc>Returns all matching category ids</search:desc>
        <search:searchResultTypeInfo>
        	<ref bean="lo.result.categoryId" />
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
        	<ref bean="lo.criteria.byCategoryNameRepoTypeState"/>
        </search:searchCriteriaTypeInfo>
    </search:searchType>
    
    <search:searchCriteriaTypeInfo id="lo.criteria.all">
        <search:name>LoLo</search:name>
        <search:desc>Placeholder Criteria</search:desc>
    </search:searchCriteriaTypeInfo>
	
	<search:searchCriteriaTypeInfo id="lo.criteria.loName">
		<search:name>LoSearchByNameCriteria</search:name>
		<search:desc>Search criteria for searching for learning objectives by name</search:desc>
        <search:queryParams>
            <ref bean="lo.queryParam.loName" />
        </search:queryParams>
	</search:searchCriteriaTypeInfo>
	
	<search:searchCriteriaTypeInfo id="lo.criteria.loByDesc">
		<search:name>LoByWordMatchCriteria</search:name>
		<search:queryParams>
			<ref bean="lo.queryParam.loDescPlain" />
		</search:queryParams>
	</search:searchCriteriaTypeInfo>

	<search:searchCriteriaTypeInfo id="lo.criteria.byOptionalCategoryName">
		<search:name>LoByCategoryCriteria</search:name>
		<search:queryParams>
			<ref bean="lo.queryParam.loOptionalCategoryName" />
		</search:queryParams>
	</search:searchCriteriaTypeInfo>
	
	<search:searchCriteriaTypeInfo id="lo.criteria.byCategoryName">
		<search:name>LoByCategoryCriteria</search:name>
		<search:queryParams>
			<ref bean="lo.queryParam.startsWith.loCategoryName" />
		</search:queryParams>
	</search:searchCriteriaTypeInfo>
		
	<search:searchCriteriaTypeInfo id="lo.criteria.byCludCode">
		<search:name>LoByCategoryCriteria</search:name>
		<search:queryParams>
			<ref bean="lo.queryParam.cluOfficialIdentifier.cluCode" />
		</search:queryParams>
	</search:searchCriteriaTypeInfo>		
		
	<search:searchCriteriaTypeInfo id="lo.criteria.byCategoryNameRepoTypeState">
		<search:name>LoByCategoryCriteria</search:name>
		<search:queryParams>
			<ref bean="lo.queryParam.loCategoryName" />
			<ref bean="lo.queryParam.loCategoryRepo" />
			<ref bean="lo.queryParam.loCategoryType" />
			<ref bean="lo.queryParam.loCategoryState" />
		</search:queryParams>
	</search:searchCriteriaTypeInfo>
		
    <search:queryParam id="lo.queryParam.loName">
	    <ref bean="field.loInfo.name.fd"/>
    </search:queryParam>
    
	<search:queryParam id="lo.queryParam.loDescPlain" optional="true">
		<ref bean="field.loInfo.desc.plain.fd"/>
    </search:queryParam>
       
	<search:queryParam id="lo.queryParam.loCategoryName">
		<ref bean="field.loCategoryInfo.name.fd"/>
    </search:queryParam>
    
	<search:queryParam id="lo.queryParam.loOptionalCategoryName" optional="true">
		<ref bean="field.loCategoryInfo.name.fd"/>
    </search:queryParam>    
    
    <search:queryParam id="lo.queryParam.cluOfficialIdentifier.cluCode" optional="true">
    	<!-- no dictionary reference unless we import the lu dictionary here which might violate service modularity -->
        <dict:fieldDescriptor parent="parentFieldDescriptor">
            <dict:name>Course Code</dict:name>
        </dict:fieldDescriptor>
    </search:queryParam>    
    
	<search:queryParam id="lo.queryParam.loCategoryRepo">
		<ref bean="field.loCategoryInfo.loRepository.fd"/>
    </search:queryParam>
    
	<search:queryParam id="lo.queryParam.loCategoryType">
		<ref bean="field.loCategoryInfo.type.fd"/>
    </search:queryParam>
    
	<search:queryParam id="lo.queryParam.loCategoryState">
		<ref bean="field.loCategoryInfo.state.fd"/>
    </search:queryParam>
    
	<search:queryParam id="lo.queryParam.startsWith.loCategoryName">
		<ref bean="field.loCategoryInfo.name.fd"/>
    </search:queryParam>
    
    <search:queryParam id="lo.queryParam.loCategoryId">
		<ref bean="field.loCategoryInfo.id.fd"/>
	</search:queryParam>
	
    <search:searchResultTypeInfo id="lo.result.los">
        <search:name>Los</search:name>
        <search:desc>List Los</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.loId" />
            <ref bean="lo.resultColumn.loName" />
        </search:resultColumns>
    </search:searchResultTypeInfo>

    <search:searchResultTypeInfo id="lo.result.loDesc">
        <search:name>Los</search:name>
        <search:desc>Lo descs</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.loDescId" />
            <ref bean="lo.resultColumn.loDescPlain" />
        </search:resultColumns>
    </search:searchResultTypeInfo>
    
    <search:searchResultTypeInfo id="lo.result.loCluByDesc">
        <search:name>Los and Related Clus</search:name>
        <search:desc>Lo descs ids and Clu ids and Codes</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.loId" />
            <ref bean="lo.resultColumn.loCluId" />
            <ref bean="lo.resultColumn.loCluCode" />
            <ref bean="lo.resultColumn.loDescPlain" />
        </search:resultColumns>
    </search:searchResultTypeInfo>    
    
    <search:searchResultTypeInfo id="lo.result.loClu">
        <search:name>Los and Related Clus</search:name>
        <search:desc>Lo descs ids and Clu ids and Codes</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.loId" />
            <ref bean="lo.resultColumn.loCluId" />
            <ref bean="lo.resultColumn.loCluCode" />
            <ref bean="lo.resultColumn.loDescPlain" />
            <ref bean="lo.resultColumn.categoryName" />            
        </search:resultColumns>
    </search:searchResultTypeInfo>
    
    <search:searchResultTypeInfo id="lo.result.categoryName">
        <search:name>Los and Related Clus</search:name>
        <search:desc>Lo descs ids and Clu ids and Codes</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.categoryId" />
            <ref bean="lo.resultColumn.categoryName" />
            <ref bean="lo.resultColumn.categoryType" />
            <ref bean="lo.resultColumn.categoryNameAndType" />
        </search:resultColumns>
    </search:searchResultTypeInfo>
    
    <search:searchResultTypeInfo id="lo.result.categoryId">
        <search:name>LoCategory id</search:name>
        <search:desc>LoCategory id</search:desc>
        <search:resultColumns>
            <ref bean="lo.resultColumn.categoryId" />
        </search:resultColumns>
    </search:searchResultTypeInfo>
    
    <search:resultColumn id="lo.resultColumn.loId">
        <search:name>Lo Identifier</search:name>
        <search:desc>Identifier of an Lo</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
	
	<search:resultColumn id="lo.resultColumn.loCluId">
        <search:name>Clu Identifier</search:name>
        <search:desc>Identifier of a Clu</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
    
    <search:resultColumn id="lo.resultColumn.loCluCode">
        <search:name>Clu Code</search:name>
        <search:desc>Clu Code</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>

    <search:resultColumn id="lo.resultColumn.loName">
        <search:name>Lo Name</search:name>
        <search:desc>Official name of an Lo</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
    
    <search:resultColumn id="lo.resultColumn.loDescId">
        <search:name>Desc Identifier</search:name>
        <search:desc>Identifier of an LO desc </search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>

    <search:resultColumn id="lo.resultColumn.loDescPlain">
        <search:name>Lo Desc</search:name>
        <search:desc>Desc of an Lo</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>

    <search:resultColumn id="lo.resultColumn.categoryName">
        <search:name>Category</search:name>
        <search:desc>Category to be used for an LO</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
        
    <search:resultColumn id="lo.resultColumn.categoryType">
        <search:name>Category</search:name>
        <search:desc>Category type for a category</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
    
    <search:resultColumn id="lo.resultColumn.categoryNameAndType">
        <search:name>Category</search:name>
        <search:desc>Category name concatenated with category type</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
    
    <search:resultColumn id="lo.resultColumn.categoryId">
        <search:name>Category ID</search:name>
        <search:desc>Category to be used for an LO</search:desc>
        <search:dataType>string</search:dataType>
    </search:resultColumn>
    
    <dict:fieldDescriptor id="parentFieldDescriptor">
        <dict:name>Comment Identifier</dict:name>
        <dict:desc>Unique identifier for a desc.</dict:desc>
        <dict:dataType>string</dict:dataType>
        <dict:readOnly>true</dict:readOnly>
    </dict:fieldDescriptor>
    
	<bean id="queryMap" class="org.springframework.beans.factory.config.MapFactoryBean">
		<property name="sourceMap">
			<map>
				<entry key="lo.search.los">
					<value>SELECT lo.id, lo.name FROM Lo lo </value>
				</entry>
				<entry key="lo.search.loByDesc">
                    <value>SELECT lo.id, loDesc.plain FROM Lo lo JOIN lo.descr loDesc</value>
				</entry>	
				<entry key="lo.queryParam.loDescPlain">
					<value>loDesc.plain</value>
				</entry>						
				<entry key="lo.search.loByName">
					<value>SELECT lo.id, lo.name FROM Lo lo WHERE lo.name = :lo_queryParam_loName</value>
				</entry>
				<entry key="lo.search.loCategories">
                    <value>SELECT cat.id, cat.name, cat.loCategoryType.name, cat.name||' - '||cat.loCategoryType.name FROM LoCategory cat WHERE cat.name like :lo_queryParam_startsWith_loCategoryName || '%' </value>
				</entry>
				<entry key="lo.search.loCategoriesByNameRepoTypeState">
                    <value>SELECT cat.id FROM LoCategory cat WHERE cat.name = :lo_queryParam_loCategoryName AND cat.loRepository.id = :lo_queryParam_loCategoryRepo AND cat.loCategoryType.id = :lo_queryParam_loCategoryType AND cat.state = :lo_queryParam_loCategoryState</value>
				</entry>
				<!--  These native searches are temporary solutions to allow cross service searches in advance of the KS permanent 
				      cross service search implementation  -->
				      
				<entry key="lo.search.loCluByDesc">
					<value>NATIVE:SELECT 
    lo.id lo_id, 
    clu.id clu_id, 
    officialIdentifier.cd code, 
    lodesc.plain plain
FROM 
    KSLU_CLU clu 
JOIN 
    KSLU_CLU_LO_RELTN jn 
    ON 
    jn.CLU_ID = clu.ID 
JOIN 
    KSLU_LO lo 
    ON 
    jn.LO_ID = lo.ID 
JOIN 
    KSLU_CLU_IDENT officialIdentifier 
    ON 
    clu.OFFIC_CLU_ID = officialIdentifier.ID 
JOIN 
    KS_LO_RICH_TEXT_T lodesc 
    ON 
    lodesc.ID = lo.RT_DESCR_ID 
					</value>
    			</entry>
    			<entry key="lo.search.loByCategory">				
					<value>NATIVE:SELECT 
    lo.id lo_id, 
    clu.id clu_id, 
    officialIdentifier.cd code, 
    lodesc.plain plain,
    cat.name name 
FROM 
    KSLU_CLU clu 
JOIN 
    KSLU_CLU_LO_RELTN jn 
    ON 
    jn.CLU_ID = clu.ID 
JOIN 
    KSLU_LO lo 
    ON 
    jn.LO_ID = lo.ID 
JOIN 
    KSLU_CLU_IDENT officialIdentifier 
    ON 
    clu.OFFIC_CLU_ID = officialIdentifier.ID 
JOIN 
    KS_LO_RICH_TEXT_T lodesc 
    ON 
    lodesc.ID = lo.RT_DESCR_ID 
JOIN 
    KSLU_LO_JN_LOCATEGORY jncat
    ON
    lo.id = jncat.lo_id
JOIN
    KSLU_LO_CATEGORY cat
    ON
    cat.id = jncat.locategory_id
					</value>
				</entry>
				<entry key="lo.queryParam.loOptionalCategoryName">
					<value>cat.name</value>
				</entry>	
    			<entry key="lo.search.loByCluCode">				
					<value>NATIVE:SELECT 
    lo.id lo_id, 
    clu.id clu_id, 
    officialIdentifier.cd code, 
    lodesc.plain plain,
    cat.name name
FROM 
    KSLU_CLU clu 
JOIN 
    KSLU_CLU_LO_RELTN jn 
    ON 
    jn.CLU_ID = clu.ID 
JOIN 
    KSLU_LO lo 
    ON 
    jn.LO_ID = lo.ID 
JOIN 
    KSLU_CLU_IDENT officialIdentifier 
    ON 
    clu.OFFIC_CLU_ID = officialIdentifier.ID 
JOIN 
    KS_LO_RICH_TEXT_T lodesc 
    ON 
    lodesc.ID = lo.RT_DESCR_ID 
JOIN 
    KSLU_LO_JN_LOCATEGORY jncat
    ON
    lo.id = jncat.lo_id
JOIN
    KSLU_LO_CATEGORY cat
    ON
    cat.id = jncat.locategory_id
					</value>
				</entry>
				<entry key="lo.queryParam.cluOfficialIdentifier.cluCode">
					<value>officialIdentifier.cd</value>
				</entry>							
            </map>
		</property>
	</bean>
</beans>
